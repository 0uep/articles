---
URL:     https://linuxfr.org/news/python-pour-noel-2019-partie-4-py-pyenv
Title:   Python 2019/2021 â€”Â partieÂ 4 â€”Â PyÂ Pyenv
Authors: Oliver, Ysabeau, Philippe F, ZeroHeure, Davy Defaud, Yves Bourguignon, Gounou, patrick_g et BenoÃ®t Sibaud
Date:    2019-09-28T11:19:34+02:00
License: CC0
Tags:    python
Score:   34
---

Python 2019/2021 â€”Â partieÂ 4 â€”Â PyÂ Pyenv
======================================

Dans les prÃ©cÃ©dentes dÃ©pÃªches, nous avons discutÃ© de la [popularitÃ© deÂ Python](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-1), de la [fin de la maintenance de Pythonâ€¯2](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-2), de lâ€™[installation de diffÃ©rentes variantes](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-3-installation-de-python-et-de-paquets) deÂ Pythonâ€¦

Ce quatriÃ¨me volet de la sÃ©rie donne des conseils pour faire cohabiter diffÃ©rentes versions de Python sur sa machine et pouvoir basculer simplement dâ€™une version Ã  lâ€™autre. On commence avec [Py](https://docs.python.org/3/using/windows.html#getting-started) et [Pyenv](https://github.com/pyenv/pyenv). La dÃ©pÃªche suivante montrera comment obtenir des rÃ©sultats similaires avec [Conda](https://en.wikipedia.org/wiki/Conda_(package_manager)) et [Docker](https://fr.wikipedia.org/wiki/Docker_(logiciel)).

La dÃ©pÃªche est au format *tutoriel* afin dâ€™Ãªtre rapidement opÃ©rationnelle. Enfin, les versions de CPython, dâ€™ActivePython, dâ€™Anaconda, deÂ Miniconda, dâ€™IronPython, deÂ Jython, deÂ MicroPython, deÂ PyPy, deÂ Pyston et de Stackless sont Ã  portÃ©e de ~~main~~ clavier. ğŸš€â€¯ğŸ [![Le logo de Python est entourÃ© de petites icÃ´nes symbolisant la variÃ©tÃ© des domaines oÃ¹ sâ€™applique Python, et, Ã Â droite, un joyeux barbu se tient derriÃ¨re un Ã©cran dâ€™ordinateur qui affiche Â«Â partieÂ =Â 4, "PyÂ Pyenv" \n print(partie)Â Â»](./2019-2021-n4.webp)](https://github.com/linuxfr.org/articles/tree/main/python/2019-2021-n4.webp)

----

* [DÃ©pÃ´t du code source de Pyenv](https://github.com/pyenv/pyenv)
* [Python pour la rentrÃ©eÂ 2019 â€”Â partieÂ 1 â€” PopularitÃ© deÂ Python](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-1)
* [Python pour la rentrÃ©eÂ 2019 â€”Â partieÂ 2 â€”Â Fin de Pythonâ€¯2](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-2)
* [Python pour la rentrÃ©eÂ 2019 â€”Â partieÂ 3 â€” Installation de Python et deÂ paquets](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-3-installation-de-python-et-de-paquets)
* [DÃ©pÃ´t du code source de Pyenv-Win, le portage pourÂ Windows](https://github.com/pyenv-win/pyenv-win)
* [Article WikipÃ©dia sur Conda, le gestionnaire de paquets Python de Miniconda/Anaconda ](https://en.wikipedia.org/wiki/Conda_(package_manager))
* [Article WikipÃ©dia sur Docker](https://fr.m.wikipedia.org/wiki/Docker_%28logiciel%29)

----

Plusieurs Pythons sur sa machine
================================

Parfois, nous avons besoin dâ€™avoir plusieurs versions de Python installÃ©es sur sa machine. Citons quelques casÂ pratiquesÂ :

* une Ã©quipe est en cours de migration dâ€™une version Python Ã  une autre, cela peut Ãªtre de Pythonâ€¯2 vers Pythonâ€¯3, mais aussi de PythonÂ 3.4 Ã  PythonÂ 3.6â€¯; et pendant la phase de transition, le logiciel doit fonctionner avec les deuxÂ versionsâ€¯;
* les utilisateurs sont hÃ©tÃ©rogÃ¨nes en termes de version de Python, cas typique du logiciel libreÂ : PythonÂ 2.6, PythonÂ 2.7, PythonÂ 3.4, PythonÂ 3.5, PythonÂ 3.6, PythonÂ 3.7, PyPy, Anaconda, Miniconda, MicroPython, etc.â€¯;
* une Ã©quipe livre des applications pour plusieurs systÃ¨mes dâ€™exploitation diffÃ©rents, lesquels utilisent des versions de Python diffÃ©rentesâ€¯; lâ€™Ã©quipe a besoin de passer facilement dâ€™une version Ã  uneÂ autreâ€¯;
* chaque membre dâ€™une Ã©quipe (dev, test, â€¦) a le choix dâ€™installer le systÃ¨me dâ€™exploitation de son choix sur sa machine, mais tous les membres doivent pouvoir tester lâ€™application avec la version cible utilisÃ©e enÂ productionâ€¯;
* on dÃ©veloppe une application Python et on souhaite vÃ©rifier si elle est bien fonctionnelle avec la future PythonÂ 3.8 (en plus de la version Python actuellement utilisÃ©e pour leÂ dÃ©veloppement).

Dans tous ces cas, câ€™est plus simple si plusieurs versions de Python sont installÃ©es sur une mÃªme machine, et si un outil nous permet de facilement passer dâ€™une version de Python Ã  une autre. Câ€™est ce que nous allons voir dans la suite de laÂ dÃ©pÃªche.

Sous Windows, gÃ©rer plusieurs versions de Python avec le lanceurÂ Py
===================================================================

Introduction
------------

Toutes les versions de Python sous Windows installent le lanceur Py (cela concerne PythonÂ 2.7 et toute la sÃ©rie des Pythonâ€¯3). Il permet de sÃ©lectionner la bonne version de Python Ã  lancer parmi les installations disponibles.

Historiquement, lancer un programme Python depuis Windows pouvait sâ€™avÃ©rer fastidieux. EnÂ effet, si lâ€™on avait omis de cocher la case Â«Â ajouter Python au chemin dâ€™exÃ©cution lors de lâ€™installationÂ Â», Python nâ€™Ã©tait pas accessible depuis la ligne de commande. Et lorsquâ€™il y a plusieurs versions de Python installÃ©es, notamment Pythonâ€¯2 et Pythonâ€¯3, cocher cette case systÃ©matiquement fait que lâ€™un des interprÃ©teurs prend le pas sur lâ€™autre et câ€™est vite le bazar. Autre facteur aggravant, les versions rÃ©centes de Python sâ€™installent selon la recommandation de Microsoft dans le rÃ©pertoire `%USERDATA%\Local\Programs\Python`, ce qui fait quâ€™elles peuvent Ãªtre pÃ©nibles Ã  retrouver ou Ã  taper en ligne de commande (fini le `C:\Python33\python.exe`).

Py apporte une solution sympathique Ã  ces problÃ¨mes. Il inspecte les informations du systÃ¨me pour dÃ©tecter toutes les versions de Python installÃ©es et propose un moyen simple de les lancer.

**âš Â Attention** de ne pas confondre [Py](https://docs.python.org/3/using/windows.html#getting-started) avec [Py.io](https://pypi.org/project/py/).

En pratique
-----------

Py sâ€™utilise en ligne de commande. Le premier argument passÃ© dÃ©signe le choix (optionnel) de lâ€™interprÃ©teur, et le reste est passÃ© Ã  la commande `python.exe` telÂ quelÂ :

    >py
    Python 3.7.0 (v3.7.0:1bf9cc5093, Jun 27 2018, 04:59:51) [MSC v.1914 64 bit (AMD64)] on win32
    Type "help", "copyright", "credits" or "license" for more information.
    >>>

Si je veux lancer du Pythonâ€¯2Â :

    >py -2
    Python 2.7.14 (v2.7.14:84471935ed, Sep 16 2017, 20:25:58) [MSC v.1500 64 bit (AMD64)] on win32
    Type "help", "copyright", "credits" or "license" for more information.
    >>>

Du Pythonâ€¯3Â :

    >py -3
    Python 3.7.0 (v3.7.0:1bf9cc5093, Jun 27 2018, 04:59:51) [MSC v.1914 64 bit (AMD64)] on win32
    Type "help", "copyright", "credits" or "license" for more information.
    >>>

On note quâ€™il a choisi la versionÂ 3.7 parÂ dÃ©faut pour Pythonâ€¯3.

Pour avoir PythonÂ 3.5 plusÂ spÃ©cifiquementÂ :

    >py -3.5
    Python 3.5.3 (v3.5.3:1880cb95a742, Jan 16 2017, 16:02:32) [MSC v.1900 64 bit (AMD64)] on win32
    Type "help", "copyright", "credits" or "license" for more information.
    >>>

Il choisit la version 64Â bits parÂ dÃ©faut. Pour avoir du PythonÂ 3.5 32Â bitsÂ :

    >py -3.5-32
    Python 3.5.1 (v3.5.1:37a07cee5969, Dec  6 2015, 01:38:48) [MSC v.1900 32 bit (Intel)] on win32
    Type "help", "copyright", "credits" or "license" for more information.
    >>>

Je liste les versions de Python installÃ©es avecÂ `pyÂ -0`Â :

    >py -0
    Installed Pythons found by py Launcher for Windows
     -3.7-64 *
     -3.5-64
     -3.5-32
     -2.7-64

Le symbole `*` indique la version utilisÃ©e par dÃ©faut.

Jâ€™utilise rÃ©guliÃ¨rement la commande `-0p` qui permet de voir oÃ¹ sont installÃ©s les interprÃ©teurs, car je ne mâ€™en rappelle jamais bien. Sur mon systÃ¨me, Ã§a donne (câ€™est un peu leÂ bazar)Â :

    >py -0p
    Installed Pythons found by py Launcher for Windows
     -3.7-64        C:\Users\g582619\AppData\Local\Programs\Python\Python37\python.exe *
     -3.5-64        C:\Users\g582619\AppData\Local\Programs\Python\Python35\python.exe
     -3.5-32        "C:\Program Files (x86)\Python35-32\python.exe"
     -2.7-64        C:\Python27\python.exe

Cette petite dÃ©mo couvre lâ€™ensemble des commandes disponibles, quâ€™on peut bien sÃ»r retrouver avec `--help` . Ã€ noter que cela va afficher lâ€™aide de Py suivie de lâ€™aide deÂ Python.

    >py --help
    Python Launcher for Windows Version 3.7.150.1013

usage:
    py [launcher-args] [python-args] script [script-args]

Launcher argumentsÂ :

    -2     : Launch the latest Python 2.x version
    -3     : Launch the latest Python 3.x version
    -X.Y   : Launch the specified Python version
         The above all default to 64 bit if a matching 64 bit python is present.
    -X.Y-32: Launch the specified 32bit Python version
    -X-32  : Launch the latest 32bit Python X version
    -X.Y-64: Launch the specified 64bit Python version
    -X-64  : Launch the latest 64bit Python X version
    -0  --list       : List the available pythons
    -0p --list-paths : List with paths

    The following help text is from Python:

    usage: C:\Users\g582619\AppData\Local\Programs\Python\Python37\python.exe [option] ... [-c cmd | -m
    mod | file | -] [arg] ...
    Options and arguments (and corresponding environment variables):
    -b     : issue warnings about str(bytes_instance), str(bytearray_instance)
    -B     : don't write .pyc files on import; also PYTHONDONTWRITEBYTECODE=x
    -c cmd : program passed in as string (terminates option list)
    â€¦

Un autre atout de Py est quâ€™il comprend la fameuse *shebangÂ line*. Ainsi, des scripts Ã©crits pour UNIX, prÃ©vus pour Ãªtre exÃ©cutables grÃ¢ce Ã  la ligne magique vont fonctionner sousÂ WindowsÂ :

    #!/usr/bin/env python

Les diffÃ©rentes variations de _shebangÂ line_ sont gÃ©rÃ©es. Et on peut combiner Ã§a astucieusement avec la sÃ©lection automatique de lâ€™interprÃ©teur. Voici un exemple concret (pourÂ rappel, sous DOS, la commande `type` est lâ€™Ã©quivalent pauvre deÂ `cat`)Â :

    >type toto2.py
    #! /usr/bin/env python2
    # lancez moi avec Python 2!
    import sys
    print sys.version

    >type toto3.py
    #! /usr/bin/env python3.5.0
    # lancez moi avec Python 3!
    async def hello(): pass # pas de async en python 2
    import sys
    print(sys.version)

On a deux programmes qui vont tous les deux refuser de fonctionner si on les lance avec la mauvaise version de Pythonâ€¯2 vs Pythonâ€¯3. Mais Py sâ€™en sort trÃ¨s bien. Et comme câ€™est lui qui est dÃ©clarÃ© comme *ouvreur* de fichiers avec lâ€™extension `.py` , on peut exÃ©cuter ces scripts directementÂ :

    >toto2.py
    2.7.14 (v2.7.14:84471935ed, Sep 16 2017, 20:25:58) [MSC v.1500 64 bit (AMD64)]

    >toto3.py
    3.5.3 (v3.5.3:1880cb95a742, Jan 16 2017, 16:02:32) [MSC v.1900 64 bit (AMD64)]

Quelques limitations
--------------------

Py rÃ©sout pas mal de problÃ¨mes, mais il conserve un gros inconvÃ©nientÂ : il ne gÃ¨re pas le rÃ©pertoire `Python/Scripts` qui contient tous les scripts ou les applications installÃ©es viaÂ `pip`.

Par exemple, pour utiliser PyQt, on a besoin dâ€™exÃ©cuter `designer.exe` et `pyuic5.exe`, qui sont installÃ©s dans `Python/Scripts`. Si vous lancez Py avec une version donnÃ©e, le `PATH` nâ€™est pas modifiÃ© et vous nâ€™avez pas accÃ¨s directement aux exÃ©cutables dont vous avez besoin. Dans ce cas, retour Ã  la case dÃ©part, avec bidouillage du `PATH` en fonction de la version Python lancÃ©e.

Un cas oÃ¹ il faut Ãªtre particuliÃ¨rement attentif Ã  ce dÃ©tail,Â est celui de lâ€™utilisation deÂ `pip`Â : `pipÂ installÂ toto` va installer le paquet `toto` dans la version parÂ dÃ©faut de Python, qui nâ€™est pas forcÃ©ment celle que vous aviez enÂ tÃªte.

La solution avec `pip` est plutÃ´t simple. Il faut penser Ã Â taperÂ :

    py -3.5 -m pip install toto

Conclusion sur Py
-----------------

Son arrivÃ©e a vraiment amÃ©liorÃ© le quotidien de la ligne de commande Python sousÂ Windows. Ã‡a marche tellement bien quâ€™une rÃ©flexion est en cours pour lâ€™adapter sousÂ UNIX.

Pour plus de dÃ©tails sur Py, allez voir la [documentation](https://docs.python.org/3.7/using/windows.html?highlight=launcher#python-launcher-for-windows).

Py rÃ©fÃ©rence les versions majeures de Python que vous avez installÃ©es sur votre systÃ¨me, mais il ne va pas vous aider Ã  les installer. EnÂ particulier, si vous voulez tester des versions de Python en dÃ©veloppement (dev, alpha ou rc), elles ne sont pas empaquetÃ©es sous forme dâ€™installateur Windows. Il faut les compiler et les installer Ã  la main. Sauf si vous utilisez Pyenvâ€¦ quâ€™on dÃ©crit justement dans la suite de laÂ dÃ©pÃªche.

Pyenv
=====

Introduction
------------

Lâ€™outil `pyenv` nâ€™a aucune dÃ©pendance visâ€Ã â€vis de Python, et peut donc Ãªtre installÃ© sur une machine dÃ©pourvue de Python. SonÂ secretâ€¯? `pyenv` est un ensemble de scripts shell (`bash`) Ã  base de [poudreÂ verte](http://poudreverte.org/).

Câ€™est le cousin des outils [`rbenv`](https://github.com/rbenv/rbenv) et [`phpenv`](https://github.com/phpenv/phpenv). Sa documentation le dÃ©crit comme le gestionnaire simple des versions Python _(Simple Python Version Management)_.

Ses fonctionnalitÃ©sÂ :

* sÃ©lection parmi des centaines de versions et interprÃ©teurs Python ([CPython](https://fr.wikipedia.org/wiki/CPython), [ActivePython](https://wiki.python.org/moin/ActivePython), [Anaconda](https://fr.wikipedia.org/wiki/Anaconda_(Python_distribution)), [Miniconda](https://stackoverflow.com/a/45421204/938111), [IronPython](https://fr.wikipedia.org/wiki/IronPython), [Jython](https://fr.wikipedia.org/wiki/Jython), [MicroPython](https://fr.wikipedia.org/wiki/MicroPython), [PyPy](https://fr.wikipedia.org/wiki/PyPy), [Pyston](https://github.com/dropbox/pyston) etÂ [Stackless](https://fr.wikipedia.org/wiki/Stackless_Python))â€¯;
* tÃ©lÃ©chargement automatique des sources et des Ã©ventuels correctifsâ€¯;
* compilation et installation automatiqueâ€¯;
* passage facile dâ€™une version Python Ã  uneÂ autre.

Avantage
--------

Son avantage principal est de permettre de tester un dÃ©veloppement en cours avec diffÃ©rentes variations Python avec lesquelles le projet cherche Ã  Ãªtre compatible. Prenons deuxÂ casÂ :

* une Ã©quipe souhaite tester son logiciel avec les versions de Python utilisÃ©es par les utilisateurs finaux comme, par exemple, Python 2.7, Python 3.4, Python 3.5, Python 3.6, Python 3.7, PyPy, Anaconda, Miniconda, etc.â€¯;
* les membres dâ€™une Ã©quipe (dev, testâ€¦) peuvent utiliser le systÃ¨me dâ€™exploitation de leur choix sur leur machine mais chaque membre doit pouvoir tester lâ€™application avec la (ouÂ les) version(s) cible(s) utilisÃ©e(s) en prod (ou par lesÂ clients).

Dans ces deux cas, les membres de lâ€™Ã©quipe peuvent avoir, avec `pyenv` sur leur ordinateur, les mÃªmes variations/versions de Python et peuvent obtenir des exÃ©cutions similaires.

En plus, `pyenv` peut sâ€™interfacer avec `virtualenv`, `pipenv` et bien dâ€™autres outils bien pratiques. Et comme [Ryzz nous leÂ signale](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-3-installation-de-python-et-de-paquets#comment-1784295), on peut utiliser `pip` sans lâ€™option `--user` car `pyenv` installe Python dans lâ€™espace utilisateur.

InconvÃ©nients
-------------

Attention, [_jihele_ nousÂ explique](https://linuxfr.org/news/python-pour-la-rentree-2019-partie-3-installation-de-python-et-de-paquets#comment-1784390) que cela nâ€™avait pas Ã©tÃ© possible dâ€™installer PythonÂ 3.7 sur Debian _Stretch_ car cette distribution nâ€™avait pas les bibliothÃ¨ques en version compatible.

En effet, `pyenv` tÃ©lÃ©charge le code source de lâ€™interprÃ©teur Python, mais pas celui de ses dÃ©pendances quâ€™il faut installer prÃ©alablement. Les anciennes versions des distributions GNU/Linux ont des vieilles versions des bibliothÃ¨ques qui peuvent Ãªtre trop anciennes par rapport aux besoins des derniÃ¨res versions des interprÃ©teurs Pythonâ€¯!

Notons que la version installÃ©e avec `pyenv` nâ€™a pas reÃ§u la mÃªme attention que la version fournie (compilÃ©e) par la distribution GNU/Linux. BienÂ souvent, lâ€™Ã©quipe dâ€™intÃ©gration (de la distribution) va empaqueter (compiler) une version en activant diffÃ©rentes optimisations comme la [LTO](https://wiki.debian.org/LTO "Link Time Optimization") et lâ€™Ã©quipe assurance qualitÃ© va vÃ©rifier que le paquet Python passe correctement lesÂ tests.

Par consÃ©quent, `pyenv` câ€™est bien pour tester la conformitÃ© avec les versions des interprÃ©teurs, mais on risque dâ€™avoir des comportements diffÃ©rents entre la version compilÃ©e par `pyenv` et la version *officielle* de chaque distribution GNU/Linux, comme, parÂ exemple, sur la vitesse dâ€™exÃ©cution ou la commutation de contexte des fils dâ€™exÃ©cution (_thread context switching_)â€¦

Un dernier point Ã  noter dans les inconvÃ©nientsÂ : la difficultÃ© pour trouver la bibliothÃ¨que nÃ©cessaire Ã  la compilation, car le message dâ€™erreur nâ€™a vraiment pas Ã©tÃ© conÃ§u pour indiquer le nom du paquet Ã Â installer. DeÂ plus, les distributions nomment rarement un paquet avec le mÃªmeÂ nom.

Donc, câ€™est bien pour les postes de lâ€™Ã©quipe projet, mais Ã  Ã©viter enÂ production.

Installer pyenv
---------------

* sous macOS, `pyenv` est disponible viaÂ [homebrew](https://github.com/pyenv/pyenv#homebrew-on-macos)â€¯;
* sous Windows, voir le portage [pyenv-win](https://github.com/pyenv-win/pyenv-win)â€¯;
* les distributions GNU/Linux nâ€™empaquettent pas (encoreâ€¯?) `pyenv`, un installateur est disponible, [pyenv-installer](https://github.com/pyenv/pyenv-installer), mais je prÃ©fÃ¨re vous indiquer aussi une mÃ©thode plus manuelle, nous allons donc voir deux faÃ§ons dâ€™installer `pyenv` â€”Â avant dâ€™exÃ©cuter les scripts ciâ€dessous, les responsables sÃ©curitÃ© recommandent de vÃ©rifier leur contenu car ces scripts pourraient aussi installer un logiciel malveillant (_malware_).

### Avec lâ€™installateur

    git clone https://github.com/pyenv/pyenv-installer
    chmod +x pyenv-installer/bin/pyenv-installer
    pyenv-installer/bin/pyenv-installer

### Ã€ la main

    mkdir -p ~/.local/git
    cd       ~/.local/git
    git clone https://github.com/pyenv/pyenv
    cd pyenv
    cd plugins/python-build

Pour partager le cache avec les autres utilisateurs avecÂ `sudo`Â :

    PREFIX=/usr/local/share/python-build sudo ./install.sh

Sans utiliser `sudo` (ma recommandation, surtout si une seule personne utilise lâ€™ordinateur)Â :

    PREFIX=~/.local/share/python-build ./install.sh

Configurer son shell
--------------------

Si on aime avoir un `$PATH` minimaliste, alors je recommande dâ€™ajouter plutÃ´t un lien symboliqueÂ :

    cd ~/.local/bin
    ln -s ~/.local/git/pyenv/bin/* .

Sinon, ajouter `exportÂ PATH="~/.local/git/pyenv/bin:$PATH"` dans le `~/.bashrc` (ou `~/.zshrc` ou autres).

Ensuite, ajouter un `evalÂ "$(pyenvÂ init -)"` dans le `~/.bashrc` ou `~/.zshrc` ou [~/.config/fish/config.fish](http://fishshell.com/docs/current/tutorial.html#tut_startup).

Au final, le `~/.bashrc` (ou `~/.zshrc` ou autres) va donc ressemblerÂ Ã Â :

```sh
# ------ pyenv ------
# activer la ligne suivante si pas de lien symbolique ~/.local/bin 
# export PATH="~/.local/git/pyenv/bin:$PATH" 
eval "$(pyenv init -)"
```

Tester lâ€™installation
---------------------

    $ source ~/.bashrc

    $ pyenv --version
    pyenv 1.2.12-5-g10bf9d22

    $ pyenv versions
    * system (set by /home/<user>/.local/git/pyenv/version)

    $ pyenv install --list | wc -l

    $ pyenv install --list
    [...]

Incroyable, `pyenv` propose 374Â variantes dâ€™interprÃ©teurs Python, avec les versions de [CPython](https://fr.wikipedia.org/wiki/CPython), [ActivePython](https://wiki.python.org/moin/ActivePython), [Anaconda](https://fr.wikipedia.org/wiki/Anaconda_(Python_distribution))/[Miniconda](https://stackoverflow.com/a/45421204/938111), [IronPython](https://fr.wikipedia.org/wiki/IronPython), [Jython](https://fr.wikipedia.org/wiki/Jython), [MicroPython](https://fr.wikipedia.org/wiki/MicroPython), [PyPy](https://fr.wikipedia.org/wiki/PyPy), [Pyston](https://github.com/dropbox/pyston) etÂ [Stackless](https://fr.wikipedia.org/wiki/Stackless_Python)â€¯!

PrÃ©requis Ã  la compilation
--------------------------

Pour installer une version de Python open source, la commande `pyenv` va tÃ©lÃ©charger le code source et le compiler. Il est donc nÃ©cessaire dâ€™installer les dÃ©pendances pour que la compilation se passe bien. Les dÃ©pendances nÃ©cessaires pour la compilation sont celles avec un suffixe `-dev` ou `-devel` selon la distribution GNU/LinuxÂ :

* avec UbuntuÂ 19.04 _DiscoÂ Dingo_Â :

        sudo apt install build-essentials
        sudo apt install libbz2-dev
        sudo apt install tk-dev
        sudo apt install libreadline-dev
        sudo apt install libsqlite3-dev

* avec FedoraÂ 29Â :

        sudo dnf install gcc make
        sudo dnf install openssl-devel
        sudo dnf install tk-devel
        sudo dnf install readline-devel
        sudo dnf install libsqlite3x-devel

Jâ€™ai pu oublier dâ€™autres dÃ©pendances. Merci de fournir vos conseils dans les commentaires. ParÂ exemple, comment cela se passe avec dâ€™autres systÃ¨mes dâ€™exploitationâ€¯?

Fichier `.python-version`
-------------------------

Câ€™est un fichier magiqueâ€¯!

```c
$ cd /chemin/projet/python

$ python --version
Python 2.7.16

$ python3 --version
Python 3.7.3

$ echo '3.5.3' > .python-version

$ pyenv install
[...] pyenv dÃ©tecte ce fichier,
      et comme CPython 3.5.3
      n'est pas encore installÃ©,
      pyenv tÃ©lÃ©charge le code source
      et le compile...

$ python --version
Python 3.5.3

$ python3 --version
Python 3.5.3
```

Installons plusieurs versions de CPython
----------------------------------------

Câ€™est partiÂ :

```c
$ pyenv install 3.4.3
(compilation...)

$ pyenv install 3.5.3
(compilation...)

$ pyenv install 3.6.8
(compilation...)

$ pyenv install 3.7.3
(compilation...)

$ pyenv install versions
* system (set by /home/oliver/.local/git/pyenv/version)
  3.4.3
  3.5.3
  3.6.8
  3.7.3
```

Maintenant, demandons Ã  `pyenv` de gÃ©rer le fichier `.python-version`Â :

```c
$ cd /un/autre/projet/python

$ ls .python-version
ls: cannot access '.python-version': No such file or directory

$ pyenv local 3.5.3

$ python --version
Python 3.5.3

$ cat .python-version
3.5.3

$ pyenv local 3.6.8

$ python --version
Python 3.6.8

$ python3 --version
Python 3.6.8

$ pyenv install versions
  3.4.3
  3.5.3
* 3.6.8 (set by /un/autre/projet/python/.python-version)
  3.7.3

$ cat .python-version
3.6.8
```

La commande `pyenv` peut aussi changer la version de Python au niveau global, mais je ne le recommande pas. Attention Ã  bien rÃ©tablir la situation normale avec `pyenvÂ globalÂ system`. Sinon, certaines commandes utilisant Python (parÂ exemple, les applications installÃ©es par le gestionnaire de paquets de votre distribution GNU/Linux) pourraient avoir des conflits de versions et ne plus fonctionnerâ€¯!

```c
$ cd /un/chemin/sans/fichier-python-version

$ python --version
Python 2.7.16

$ python3 --version
Python 3.7.3

$ pyenv global 3.5.3

$ python --version
Python 3.5.3

$ pyenv global 3.6.8

$ python --version
Python 3.6.8

$ python3 --version
Python 3.6.8

$ pyenv global system
```

Alternatives
============

* certains gestionnaires de paquets Python commeÂ `conda`â€¯;
* la conteneurisation, comme avecÂ Dockerâ€¯;
* les gestionnaires modernes de paquets comme `nix` etÂ `guix`.

La prochaine dÃ©pÃªche (partieÂ 5) abordera ces sujets.â€¯ğŸ¤“

[![La mascotte de Linux, Tux, en train de voler avec le logo Python sur sa cape et sur sa tenue. Attention, cette image peut ne pas sâ€™afficher car elle est au format WebP et ce format nâ€™est pas toujours pris en charge. Si tel est le cas, merci de nous le signaler dans les commentaires et nous rectifierons le tir pour les prochaines dÃ©pÃªches.](http://olibre.github.io/GreatTips/python/news/tux-python.png)](https://github.com/olibre/GreatTips/tree/master/python)

Remerciements
=============

Merci Ã  tous les contributeurs (et les contributrices) de cette dÃ©pÃªche, et notamment Ã  [PhilippeÂ F.](https://linuxfr.org/users/bluebird) pour avoir rÃ©digÃ© la moitiÃ© de cette dÃ©pÃªche et Ã Â [Ysabeau](https://linuxfr.org/users/ysabeau) pour avoir initiÃ© les illustrations de cette sÃ©rie de dÃ©pÃªches.â€¯ğŸ¤©â€¯ğŸ¨â€¯ğŸ–Œ Continuons Ã  participer aux prochaines dÃ©pÃªches.â€¯ğŸ‘â€¯ğŸ‘â€¯ğŸ‘â€¯ğŸ‘

Licence
=======

Cette dÃ©pÃªche est publiÃ©e sous [licenceÂ CC0](https://fr.m.wikipedia.org/wiki/Licence_CC0) (dans le domaine public dans les pays oÃ¹ câ€™est possible) pour permettre de la recopier, modifier, rÃ©utiliser et republier sans obligation de citer ses auteurs quelle que soit la loi de certains pays comme la France, qui oblige quand mÃªme Ã  citer les auteurs. AuÂ moins, cela montre lâ€™intention des auteurs Ã  autoriser leÂ plagiat.

Tes astucesâ€¯?
=============

Nâ€™hÃ©site pas Ã  partager tes expÃ©riences, tes astuces et tesÂ interrogations.

Appel Ã  contribution
--------------------

Donneâ€nous un coup de main pour la rÃ©daction des dÃ©pÃªches Ã Â venirÂ : [CondaÂ etÂ Docker](https://linuxfr.org/redaction/news/python-pour-noel-2019-partie-5-conda-docker), [PipÂ etÂ Pipx](https://linuxfr.org/news/python-pour-noel-2019-partie-6-pip-et-pipx), [environnements virtuels](https://linuxfr.org/news/python-pour-noel-2019-partie-7-environnements-virtuels), [Pipenv](https://linuxfr.org/news/python-pour-noel-2019-partie-8-pipenv), [empaquetage](https://linuxfr.org/news/python-pour-noel-2019-partie-9-empaquetage), formateur deÂ code, analyseÂ statique, les apports des derniÃ¨res versions Python ([`asyncio`](https://docs.python.org/fr/3/library/asyncio.html), [typeÂ hints](https://docs.python.org/fr/3/library/typing.html)â€¦), entretiens avec des utilisateurs Python pas comme les autresâ€¦ Par manque de contributions, la sÃ©rie initialement nommÃ©e Â«Â pour la rentrÃ©eÂ 2019Â Â» a Ã©tÃ© renommÃ©e en Â«Â pourÂ NoÃ«lÂ 2019Â Â»â€¯! Ton aide sera laÂ bienvenue.â€¯ğŸ’š
